<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Genesis Study - TTS Version</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Ï†ÑÏ≤¥ Ï§ëÏïô Ï†ïÎ†¨ */
        body {
            margin: 0;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            font-family: 'Segoe UI', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        /* Ïπ¥Îìú */
        #card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }
        /* ÌûàÎ∏åÎ¶¨Ïñ¥ Îã®Ïñ¥ */
        #hebrew {
            font-size: 90px;
            direction: rtl;
            margin-bottom: 30px;
            font-weight: bold;
        }
        /* ÏÑ§Î™Ö ÌÖçÏä§Ìä∏ */
        .info {
            font-size: 24px;
            margin: 10px 0;
        }
        /* Î≤ÑÌäº ÏòÅÏó≠ */
        #nav {
            margin-top: 30px;
        }
        button {
            font-size: 20px;
            padding: 12px 25px;
            margin: 10px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: transform 0.1s;
        }
        button:active {
            transform: scale(0.95);
        }
        button:disabled {
            opacity: 0.3;
            cursor: default;
        }
        #backBtn { background: #888; color: white; }
        #nextBtn { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <div id="card">
        <div id="chapterTitle"></div>
        <div id="hebrew"></div>
        <div class="info" id="root"></div>
        <div class="info" id="meaning"></div>
        <div class="info" id="gloss"></div>
        <div id="nav">
            <button id="backBtn">< Ïù¥Ï†Ñ</button>
            <button id="nextBtn">Îã§Ïùå ></button>
        </div>
    </div>

    <!-- data.js Î°úÎìú -->
    <script src="data.js"></script>
    <script>
        const params = new URLSearchParams(location.search);
        let ch = params.get("ch") || "1";
        const words = bibleData[ch];
        let index = 0;

        const hebrewEl = document.getElementById("hebrew");
        const rootEl = document.getElementById("root");
        const meaningEl = document.getElementById("meaning");
        const glossEl = document.getElementById("gloss");
        const backBtn = document.getElementById("backBtn");
        const nextBtn = document.getElementById("nextBtn");
        const titleEl = document.getElementById("chapterTitle");

        titleEl.innerHTML = `<h2>Genesis ${ch} ÌïôÏäµ</h2>`;

        // üîä TTS Ïû¨ÏÉù ÏÉÅÌÉú Í¥ÄÎ¶¨ Î≥ÄÏàò
        let isTtsActive = true; 

        // üîä ÌûàÎ∏åÎ¶¨Ïñ¥ Ïû¨ÏÉù Ìï®Ïàò
        function speakHebrew(text) {
            // Í∏∞Ï°¥ Ïû¨ÏÉù Ï§ëÏù∏ ÏùåÏÑ± Î™®Îëê Ï∑®ÏÜå
            window.speechSynthesis.cancel();

            if (!isTtsActive) return;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'he-IL'; // ÌûàÎ∏åÎ¶¨Ïñ¥ ÏÑ§Ï†ï
            utterance.rate = 0.7;    // ÌïôÏäµÏùÑ ÏúÑÌï¥ ÏïΩÍ∞Ñ Ï≤úÏ≤úÌûà

            // Ïû¨ÏÉùÏù¥ ÎÅùÎÇòÎ©¥ Îã§Ïãú Ïû¨ÏÉù (Î¨¥Ìïú Î∞òÎ≥µ)
            utterance.onend = () => {
                if (isTtsActive) {
                    window.speechSynthesis.speak(utterance);
                }
            };

            window.speechSynthesis.speak(utterance);
        }

        function render() {
            if (!words || words.length === 0) {
                hebrewEl.textContent = "Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå";
                return;
            }

            const w = words[index];
            hebrewEl.textContent = w.form;
            rootEl.textContent = "Ïñ¥Í∑º: " + w.root;
            meaningEl.textContent = "Îúª: " + w.meaning.join(", ");
            glossEl.textContent = "gloss: " + w.gloss;

            backBtn.disabled = (index === 0);
            nextBtn.disabled = (index === words.length - 1);

            // Îã®Ïñ¥ Î†åÎçîÎßÅ Ïãú ÏùåÏÑ± Ïû¨ÏÉù ÏãúÏûë
            speakHebrew(w.form);
        }

        backBtn.onclick = () => {
            if (index > 0) {
                index--;
                render();
            }
        };

        nextBtn.onclick = () => {
            if (index < words.length - 1) {
                index++;
                render();
            }
        };

        // Ï¥àÍ∏∞ Ïã§Ìñâ (Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÌôïÏù∏ ÌõÑ)
        window.onload = () => {
            if (typeof bibleData !== 'undefined') {
                render();
            } else {
                console.error("data.jsÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
            }
        };

        // ÌéòÏù¥ÏßÄÎ•º Îñ†ÎÇ† Îïå ÏùåÏÑ± Ï§ëÏßÄ
        window.onbeforeunload = () => {
            window.speechSynthesis.cancel();
        };
    </script>
</body>
</html>
