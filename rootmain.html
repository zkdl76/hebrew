<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Genesis Root Master - ì–´ê·¼+ëœ» í•™ìŠµ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ì „ì²´ ë°°ê²½ ë° ë ˆì´ì•„ì›ƒ */
        body { background: #0f172a; color: white; text-align: center; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        
        #statusBoard { 
            display: flex; justify-content: space-around; padding: 15px; 
            background: rgba(255,255,255,0.05); border-radius: 15px; margin-bottom: 20px;
        }

        #wordCanvas { 
            font-size: 90px; margin: 40px 0; min-height: 140px; 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-shadow: 0 0 20px rgba(255,255,255,0.1);
        }

        /* ì •ì˜¤ë‹µ ì• ë‹ˆë©”ì´ì…˜ */
        .correct { color: #4ade80; transform: scale(1.1); text-shadow: 0 0 30px rgba(74, 222, 128, 0.4); }
        .wrong { color: #f87171; animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-15px); } 75% { transform: translateX(15px); } }

        /* ì…ë ¥ì°½ ë° ë²„íŠ¼ */
        #answerInput { 
            font-size: 22px; padding: 12px 20px; border-radius: 10px; border: 2px solid #334155; 
            width: 300px; text-align: center; background: #1e293b; color: white; outline: none;
        }
        #answerInput:focus { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }

        button { 
            padding: 12px 25px; font-size: 18px; cursor: pointer; border-radius: 10px; border: none; 
            margin: 8px; font-weight: bold; transition: 0.2s;
        }
        button:active { transform: scale(0.95); }
        .btn-main { background: #3b82f6; color: white; }
        .btn-study { background: #8b5cf6; color: white; }
        .btn-hint { background: #f59e0b; color: white; }

        #feedback { height: 60px; margin-top: 15px; font-size: 22px; font-weight: 500; }
        .wrong-item { display: inline-block; margin: 5px; padding: 6px 12px; background: #334155; border-radius: 6px; font-size: 14px; }
    </style>
</head>
<body>

<div id="statusBoard">
    <div>STAGE: <span id="lvDisplay">1</span></div>
    <div>POINTS: <span id="scoreDisplay">10</span></div>
    <div>REMAIN: <span id="remainDisplay">0</span></div>
</div>

<div id="timerContainer" style="font-size: 26px;">
    TIME: <span id="timeVal" style="color: #fbbf24;">10</span>
</div>

<div id="wordCanvas">ë¡œë”© ì¤‘...</div>

<div style="margin-bottom: 25px;">
    <select id="chapterSelect" style="font-size: 18px; padding: 8px; border-radius: 8px; background: #1e293b; color: white;"></select>
    <button onclick="goStudy()" class="btn-study">ğŸ“˜ í•™ìŠµí•˜ê¸°</button>
</div>

<input id="answerInput" placeholder="ì˜ˆ: ì•„ë§ˆë¥´ ë§í•˜ë‹¤" autocomplete="off">
<br>
<button onclick="checkAnswer()" class="btn-main">í™•ì¸ (Enter)</button>
<button onclick="buyHint()" id="hintBtn" class="btn-hint" style="display:none;">íŒíŠ¸ êµ¬ë§¤ (-5P)</button>

<div id="feedback"></div>

<div style="margin-top: 40px; border-top: 1px solid #334155; padding-top: 20px;">
    <h3 style="color: #94a3b8;">ì˜¤ë‹µ ë³´ê´€ì†Œ</h3>
    <div id="wrongItems">ì—†ìŒ</div>
</div>

<script src="data.js"></script>
<script>
    let currentChapter = 1;
    let currentVerbs = [];
    let wrongAnswers = [];
    let current = null;
    let score = 10;
    let unlockedStages = JSON.parse(localStorage.getItem("unlocked")) || [1];
    let timeLeft = 10;
    let timer = null;
    let isProcessing = false;

    const canvas = document.getElementById("wordCanvas");
    const input = document.getElementById("answerInput");
    const feedbackEl = document.getElementById("feedback");
    const scoreDisp = document.getElementById("scoreDisplay");
    const remainDisp = document.getElementById("remainDisplay");
    const wrongDiv = document.getElementById("wrongItems");
    const hintBtnEl = document.getElementById("hintBtn");
    const timeDisp = document.getElementById("timeVal");
    const chapterSelect = document.getElementById("chapterSelect");
    const lvDisplay = document.getElementById("lvDisplay");

    function saveUnlock() { localStorage.setItem("unlocked", JSON.stringify(unlockedStages)); }

    function updateDropdown() {
        chapterSelect.innerHTML = "";
        Object.keys(bibleData).forEach(ch => {
            const opt = document.createElement("option");
            opt.value = ch;
            const isUnlocked = unlockedStages.includes(parseInt(ch));
            opt.textContent = (isUnlocked ? "ğŸ“–" : "ğŸ”’") + " Genesis " + ch;
            opt.disabled = !isUnlocked;
            chapterSelect.appendChild(opt);
        });
        chapterSelect.value = currentChapter;
    }

    function loadChapter(ch) {
        currentChapter = parseInt(ch);
        lvDisplay.textContent = currentChapter;
        currentVerbs = [...bibleData[ch]];
        wrongAnswers = [];
        updateStatus();
        nextQuestion();
    }

    function updateStatus() {
        scoreDisp.textContent = score;
        remainDisp.textContent = currentVerbs.length;
        hintBtnEl.style.display = score >= 5 ? "inline-block" : "none";
        wrongDiv.innerHTML = wrongAnswers.length === 0 
            ? "ì—†ìŒ" 
            : wrongAnswers.map(w => `<span class='wrong-item'>${w.form}</span>`).join("");
    }

    function startTimer() {
        clearInterval(timer);
        timeLeft = 10;
        timeDisp.textContent = timeLeft;
        timer = setInterval(() => {
            timeLeft--;
            timeDisp.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timer);
                handleWrong("âŒ› ì‹œê°„ ì´ˆê³¼! -2P");
            }
        }, 1000);
    }

    function nextQuestion() {
        if (currentVerbs.length === 0 && wrongAnswers.length === 0) {
            clearInterval(timer);
            canvas.innerHTML = "<span style='color:#fbbf24;'>STAGE CLEAR! âœ¨</span>";
            const next = currentChapter + 1;
            if (bibleData[next] && !unlockedStages.includes(next)) {
                unlockedStages.push(next);
                saveUnlock();
                updateDropdown();
            }
            return;
        }

        isProcessing = false;
        canvas.className = "";
        let pool = currentVerbs.length > 0 ? currentVerbs : wrongAnswers;
        current = pool[Math.floor(Math.random() * pool.length)];

        canvas.textContent = current.form;
        input.value = "";
        input.focus();
        feedbackEl.innerHTML = "";
        startTimer();
    }

    function checkAnswer() {
        if (isProcessing || !current) return;
        const val = input.value.trim();
        
        // ë°ì´í„°ì—ì„œ ì–´ê·¼ê³¼ ì²« ë²ˆì§¸ ëœ» ì¶”ì¶œ
        const rootName = current.root; 
        const primaryMeaning = current.meaning[0]; 

        // âœ… ì–´ê·¼ê³¼ ì²« ë²ˆì§¸ ëœ»ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ì•¼ ì •ë‹µ (ê³µë°± ìƒê´€ì—†ì´ ì²´í¬)
        const combinedInput = val.replace(/\s/g, '');
        const isCorrect = combinedInput.includes(rootName) && combinedInput.includes(primaryMeaning);

        if (isCorrect) {
            isProcessing = true;
            clearInterval(timer);
            score += 10;
            canvas.className = "correct";
            feedbackEl.innerHTML = `<span style='color:#4ade80;'>ì •ë‹µ! +10P</span><br><small>${rootName} ${current.meaning.join(', ')}</small>`;
            
            currentVerbs = currentVerbs.filter(v => v.form !== current.form);
            wrongAnswers = wrongAnswers.filter(v => v.form !== current.form);
            
            updateStatus();
            setTimeout(nextQuestion, 1500);
        } else {
            handleWrong("âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! -2P");
        }
    }

    function handleWrong(msg) {
    isProcessing = true;
    clearInterval(timer);
    score -= 2;
    canvas.className = "wrong";
    
    // âœ… ì •ë‹µ ë…¸ì¶œ: ì–´ê·¼ê³¼ ëœ»ì„ ê²°í•©í•˜ì—¬ í¬ê²Œ ë³´ì—¬ì¤Œ
    // ì˜ˆ: "ì•„ë§ˆë¥´ ë§í•˜ë‹¤, ì´ë¥´ë‹¤"
    const correctRoot = current.root;
    const correctMeaning = current.meaning.join(', '); // ë°°ì—´ì¸ ëœ»ì„ ì‰¼í‘œë¡œ ì—°ê²°
    
    feedbackEl.innerHTML = `
        <span style='color:#f87171; font-weight:bold;'>${msg}</span><br>
        <div style='margin-top:10px; color:#fff; font-size:24px;'>
            ì •ë‹µ: <span style='color:#fbbf24;'>${correctRoot}</span> 
            <span style='color:#4ade80;'>${correctMeaning}</span>
        </div>
    `;

    // ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
    if (!wrongAnswers.find(v => v.form === current.form)) {
        wrongAnswers.push(current);
    }

    // ê²Œì„ ì˜¤ë²„ ì²´í¬
    if (score < 0) {
        alert("GAME OVER! ì ìˆ˜ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.");
        score = 10;
        loadChapter(currentChapter);
        return;
    }

    updateStatus();
    
    // ì˜¤ë‹µì„ í™•ì¸í•˜ê³  ì™¸ìš¸ ì‹œê°„ì„ 2.5ì´ˆë¡œ ë„‰ë„‰íˆ ì„¤ì •
    setTimeout(nextQuestion, 2500); 
}


    function buyHint() {
        if (score < 5) return;
        score -= 5;
        // ì–´ê·¼ ì²« ê¸€ìì™€ ëœ» ì²« ê¸€ì íŒíŠ¸ ì œê³µ
        const hintText = `${current.root[0]}... ${current.meaning[0][0]}...`;
        feedbackEl.innerHTML = `<div style='color:#f59e0b;'>íŒíŠ¸: ${hintText}</div>`;
        updateStatus();
        input.focus();
    }

    function goStudy() {
        location.href = "study.html?ch=" + currentChapter;
    }

    chapterSelect.onchange = (e) => loadChapter(e.target.value);
    input.onkeypress = (e) => { if (e.key === "Enter") checkAnswer(); };

    window.onload = () => {
        updateDropdown();
        loadChapter(1);
    };
</script>
</body>
</html>
