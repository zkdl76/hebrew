
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Genesis Root Master</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="statusBoard">
<div>STAGE: <span id="lvDisplay">1</span></div>
<div>POINTS: <span id="scoreDisplay">10</span></div>
<div>REMAIN: <span id="remainDisplay">0</span></div>
</div>

<div id="timerContainer">TIME: <span id="timeVal">10</span></div>
<div id="eventIndicator"></div>

<select id="chapterSelect"></select>
<button onclick="goStudy()">ğŸ“˜ í•™ìŠµí•˜ê¸°</button>

<div id="wordCanvas"></div>

<input id="answerInput" placeholder="ì–´ê·¼ ëœ» ì…ë ¥">
<br>
<button onclick="checkAnswer()">í™•ì¸</button>
<button onclick="buyHint()" id="hintBtn" style="display:none;">íŒíŠ¸ êµ¬ë§¤ (-5P)</button>

<div id="feedback"></div>

<div>
<h3>ì˜¤ë‹µ ë³´ê´€ì†Œ</h3>
<div id="wrongItems"></div>
</div>

<script src="data.js"></script>

<script>
let currentChapter=1;
let currentVerbs=[];
let wrongAnswers=[];
let current=null;

let score=10;
let unlockedStages=JSON.parse(localStorage.getItem("unlocked"))||[1];

let timeLeft=10;
let timer=null;

const canvas=wordCanvas;
const input=answerInput;
const feedback=feedback;
const scoreDisp=scoreDisplay;
const remainDisp=remainDisplay;
const wrongDiv=wrongItems;
const hintBtn=hintBtn;
const timeDisp=timeVal;
const eventInd=eventIndicator;

function saveUnlock(){
localStorage.setItem("unlocked",JSON.stringify(unlockedStages));
}

function updateDropdown(){
chapterSelect.innerHTML="";
Object.keys(bibleData).forEach(ch=>{
const opt=document.createElement("option");
opt.value=ch;
opt.textContent=(unlockedStages.includes(+ch)?"ğŸ“– ":"ğŸ”’ ")+"Genesis "+ch;
opt.disabled=!unlockedStages.includes(+ch);
chapterSelect.appendChild(opt);
});
chapterSelect.value=currentChapter;
}

function loadChapter(ch){
currentChapter=+ch;
currentVerbs=[...bibleData[ch]];
wrongAnswers=[];
updateStatus();
nextQuestion();
}

function updateStatus(){
scoreDisp.textContent=score;
remainDisp.textContent=currentVerbs.length;
wrongDiv.innerHTML=wrongAnswers.map(w=>"<span class='wrong-item'>"+w.form+"</span>").join("");
}

function startTimer(){
clearInterval(timer);
timeLeft=10;
timeDisp.textContent=timeLeft;
timer=setInterval(()=>{
timeLeft--;
timeDisp.textContent=timeLeft;
if(timeLeft<=0){
clearInterval(timer);
timeout();
}
},1000);
}

function timeout(){
feedback.innerHTML="TIME OVER! "+current.root;
if(!wrongAnswers.find(v=>v.form===current.form))wrongAnswers.push(current);
updateStatus();
setTimeout(nextQuestion,2000);
}

function nextQuestion(){
let pool=[...currentVerbs,...wrongAnswers];
if(pool.length===0){
canvas.textContent="CLEAR!";
const next=currentChapter+1;
if(bibleData[next]&&!unlockedStages.includes(next)){
unlockedStages.push(next);
saveUnlock();
updateDropdown();
}
return;
}
pool=pool.filter(v=>!current||v.form!==current.form);
current=pool[Math.floor(Math.random()*pool.length)];
canvas.textContent=current.form;
startTimer();
}

function checkAnswer(){
const val=input.value.trim();
if(val.includes(current.root)){
score+=10;
feedback.innerHTML="ì •ë‹µ! +10P";
currentVerbs=currentVerbs.filter(v=>v.form!==current.form);
wrongAnswers=wrongAnswers.filter(v=>v.form!==current.form);
}else{
score-=2;
feedback.innerHTML="ì˜¤ë‹µ! "+current.root;
if(!wrongAnswers.find(v=>v.form===current.form))wrongAnswers.push(current);
}
input.value="";
updateStatus();
setTimeout(nextQuestion,1000);
}

function buyHint(){
if(score<5)return;
score-=5;
feedback.innerHTML="<div class='hint-box'>íŒíŠ¸: "+current.root.charAt(0)+"...</div>";
updateStatus();
}

function goStudy(){
location.href="study.html?ch="+currentChapter;
}

chapterSelect.onchange=()=>loadChapter(chapterSelect.value);

updateDropdown();
loadChapter(1);
</script>

</body>
</html>
