<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Genesis Root RPG v3.0</title>
<style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f2027, #2c5364); color: white; text-align: center; min-height: 100vh; padding: 20px; }
    #statusBoard { display: flex; justify-content: space-around; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; border: 1px solid #00d4ff; }
    #wordContainer { height: 180px; display: flex; justify-content: center; align-items: center; position: relative; margin-top: 10px; }
    #wordCanvas { font-size: 80px; direction: rtl; font-weight: bold; }
    select { padding: 10px; font-size: 16px; border-radius: 8px; background: #1a2a6c; color: white; border: 1px solid #00d4ff; margin-bottom: 10px; }
    input { padding: 15px; font-size: 18px; width: 300px; border-radius: 10px; border: none; text-align: center; }
    button { padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; margin: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
    #checkBtn { background-color: #00d4ff; color: #00334e; }
    #hintBtn { background-color: #ffeb3b; color: #333; display: none; } /* 3íšŒ ì˜¤ë¥˜ì‹œ ë“±ì¥ */
    #nextLevelBtn { background-color: #00ff88; color: #00334e; display: none; padding: 20px; font-size: 20px; width: 100%; max-width: 400px; margin: 20px auto; }
    #feedback { margin-top: 15px; font-size: 19px; min-height: 80px; line-height: 1.5; }
    .hint-box { color: #ffeb3b; font-size: 18px; margin-top: 10px; padding: 10px; border: 1px dashed #ffeb3b; border-radius: 10px; }
    #wrongListContainer { margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
    .wrong-item { display: inline-block; background: rgba(255,61,0,0.2); padding: 5px 12px; margin: 5px; border-radius: 20px; border: 1px solid #ff3d00; direction: rtl; font-size: 18px; }
    .correct::after { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 120px; height: 120px; border: 8px solid #00ff88; border-radius: 50%; opacity: 0.6; }
</style>
</head>
<body>

<div id="statusBoard">
    <div>LEVEL: <span id="lvDisplay">1</span></div>
    <div>SCORE: <span id="scoreDisplay" style="color:#00ff88">0</span> P</div>
    <div>ë‚¨ì€ ë‹¨ì–´: <span id="remainDisplay">0</span></div>
</div>

<select id="chapterSelect" onchange="changeChapter()"></select>

<div id="wordContainer">
    <span id="wordCanvas">ì¤€ë¹„!</span>
</div>

<div>
    <input type="text" id="answerInput" placeholder="ì–´ê·¼ ëœ» (ì˜ˆ: ë°”ë¼ ì°½ì¡°í•˜ë‹¤)" autocomplete="off">
    <button id="checkBtn" onclick="checkAnswer()">í™•ì¸</button>
    <button id="hintBtn" onclick="buyHint()">ğŸ’¡ íŒíŠ¸ êµ¬ë§¤ (-5P)</button>
</div>

<div id="feedback"></div>
<button id="nextLevelBtn" onclick="levelUp()">ğŸ‰ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„ì¶œí•˜ê¸°! ğŸ‰</button>

<div id="wrongListContainer">
    <h3 style="margin: 0;">âŒ ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸</h3>
    <div id="wrongItems" style="margin-top: 10px;">í´ë¦¬ì–´ ì‹œ ë ˆë²¨ì—… ê°€ëŠ¥!</div>
</div>

<script>
const bibleData = {
    1: [
        {form:"×‘×¨ì•„", root:"ë°”ë¼", meaning:["ì°½ì¡°í•˜ë‹¤"], gloss:"ê·¸ê°€ ì°½ì¡°í–ˆë‹¤"},
        {form:"×•×™×ë¨¸", root:"ì•„ë§ˆë¥´", meaning:["ë§í•˜ë‹¤","ì´ë¥´ë‹¤"], gloss:"ê·¸ê°€ ë§í–ˆë‹¤"},
        {form:"×™×”ì´", root:"í•˜ì•¼", meaning:["ìˆë‹¤","ë˜ë‹¤"], gloss:"ìˆê²Œ ë˜ë¼"},
        {form:"×•×™×¨×", root:"ë¼ì•„", meaning:["ë³´ë‹¤"], gloss:"ê·¸ê°€ ë³´ì•˜ë‹¤"},
        {form:"×•×™×‘×“×œ", root:"ë°”ë‹¬", meaning:["ë‚˜ëˆ„ë‹¤","êµ¬ë³„í•˜ë‹¤"], gloss:"ê·¸ê°€ ë‚˜ëˆ„ì…¨ë‹¤"}
    ],
    2: [
        {form:"×•×™×›×œ×•", root:"ì¹¼ë¼", meaning:["ë§ˆì¹˜ë‹¤","ì™„ì„±í•˜ë‹¤"], gloss:"ê·¸ë“¤ì´ ë§ˆì³ì¡Œë‹¤"},
        {form:"×•×™×©×‘×ª", root:"ìƒ¤ë°”íŠ¸", meaning:["ì•ˆì‹í•˜ë‹¤","ì‰¬ë‹¤"], gloss:"ê·¸ê°€ ì‰¬ì…¨ë‹¤"},
        {form:"×•×™×™×¦×¨", root:"ì•¼ì°¨ë¥´", meaning:["ì§€ìœ¼ì‹œë‹¤","ë¹šë‹¤"], gloss:"ê·¸ê°€ ë¹šìœ¼ì…¨ë‹¤"}
    ]
};

let currentChapter = 1, currentVerbs = [], wrongAnswers = [], current = null;
let score = 0, failCount = 0, timer = null;

const canvas = document.getElementById("wordCanvas"), input = document.getElementById("answerInput"), 
      feedback = document.getElementById("feedback"), scoreDisp = document.getElementById("scoreDisplay"),
      remainDisp = document.getElementById("remainDisplay"), lvDisp = document.getElementById("lvDisplay"),
      hintBtn = document.getElementById("hintBtn"), nextBtn = document.getElementById("nextLevelBtn"),
      wrongItemsDiv = document.getElementById("wrongItems"), chSelect = document.getElementById("chapterSelect");

function init() {
    chSelect.innerHTML = Object.keys(bibleData).map(ch => `<option value="${ch}">ì°½ì„¸ê¸° ${ch}ì¥</option>`).join("");
    loadChapter(1);
}

function loadChapter(ch) {
    currentChapter = parseInt(ch);
    currentVerbs = [...bibleData[ch]];
    wrongAnswers = [];
    failCount = 0;
    lvDisp.innerText = ch;
    nextBtn.style.display = "none";
    updateStatus();
    newQuestion();
}

function changeChapter() { loadChapter(chSelect.value); }

function updateStatus() {
    scoreDisp.innerText = score;
    remainDisp.innerText = currentVerbs.length;
    wrongItemsDiv.innerHTML = wrongAnswers.length === 0 ? "í´ë¦¬ì–´ ì‹œ ë ˆë²¨ì—… ê°€ëŠ¥!" : 
        wrongAnswers.map(v => `<span class="wrong-item">${v.form}</span>`).join("");
}

function newQuestion() {
    if(currentVerbs.length === 0 && wrongAnswers.length === 0) {
        canvas.innerText = "CLEAR!";
        feedback.innerHTML = `<b style="color:#00ff88">ì¶•í•˜í•©ë‹ˆë‹¤! ${currentChapter}ì¥ì„ ì •ë³µí–ˆìŠµë‹ˆë‹¤!</b>`;
        nextBtn.style.display = "block"; // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ ë…¸ì¶œ
        return;
    }
    canvas.className = "";
    hintBtn.style.display = "none";
    failCount = 0;
    // ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ê±°ê¸°ì„œ ë¨¼ì € ëƒ„, ì—†ìœ¼ë©´ ì „ì²´ ë¦¬ìŠ¤íŠ¸
    let source = wrongAnswers.length > 0 ? wrongAnswers : currentVerbs;
    current = source[Math.floor(Math.random() * source.length)];
    canvas.innerText = current.form;
    feedback.innerHTML = ""; input.value = ""; input.focus();
}

function checkAnswer() {
    if(timer) clearTimeout(timer);
    const p = input.value.trim().split(/\s+/);
    const isCorrect = (normalize(p[0]||"") == normalize(current.root)) && 
                      current.meaning.some(m => normalize(m) == normalize(p.slice(1).join("")));

    if(isCorrect) {
        canvas.className = "correct";
        score += 10;
        feedback.innerHTML = `<b style="color:#00ff88">+10P ì •ë‹µ!</b><br>ì–´ê·¼: ${current.root} (${current.meaning[0]})`;
        
        currentVerbs = currentVerbs.filter(v => v.form !== current.form);
        wrongAnswers = wrongAnswers.filter(v => v.form !== current.form);
        updateStatus();
        timer = setTimeout(newQuestion, 2000);
    } else {
        failCount++;
        score = Math.max(0, score - 2); // í‹€ë¦¬ë©´ 2ì  ê°ì  (ê¸´ì¥ê°!)
        input.value = ""; input.focus();
        feedback.innerHTML = `<b style="color:#ff3d00">ì˜¤ë‹µ! (${failCount}íšŒ)</b> -2P ê°ì !`;
        if(failCount >= 3) hintBtn.style.display = "inline-block";
        if(failCount >= 5) {
            feedback.innerHTML = `<b style="color:#ffeb3b">ê¸°íšŒ ì¢…ë£Œ! ì •ë‹µì€ [${current.root} ${current.meaning[0]}]</b>`;
            timer = setTimeout(newQuestion, 4000);
        }
        addWrong(current);
        updateStatus();
    }
}

function addWrong(v) { if(!wrongAnswers.find(w => w.form === v.form)) wrongAnswers.push(v); }

function buyHint() {
    if(score < 5) { feedback.innerHTML = "ì ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (5P í•„ìš”)"; return; }
    score -= 5;
    const r = current.root.split("");
    const rIdx = Math.floor(Math.random() * 3);
    const hintRoot = r.map((c, i) => i === rIdx ? c : "ã…‡").join("");
    const hintMean = current.meaning[0].charAt(0) + "ã…‡ã…‡";
    
    feedback.innerHTML = `<div class="hint-box">ğŸ’¸ íŒíŠ¸ êµ¬ë§¤ ì™„ë£Œ (-5P)<br>ì–´ê·¼: [${hintRoot}] / ëœ»: [${hintMean}]</div>`;
    hintBtn.style.display = "none";
    scoreDisp.innerText = score;
}

function levelUp() {
    const next = currentChapter + 1;
    if(bibleData[next]) {
        chSelect.value = next;
        loadChapter(next);
    } else {
        alert("ë‹¤ìŒ ì¥ ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤! ì—…ë°ì´íŠ¸ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
    }
}

function normalize(t){return t.trim().replace(/\s+/g,"");}
input.addEventListener("keypress", e => { if(e.key==="Enter") checkAnswer(); });
init();
</script>

</body>
</html>
