<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Genesis Root Master: Hardcore</title>
<style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1a0a0a, #301934); color: white; text-align: center; min-height: 100vh; padding: 20px; }
    #statusBoard { display: flex; justify-content: space-around; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ff3d00; font-weight: bold; }
    #eventIndicator { font-size: 20px; height: 30px; margin-bottom: 10px; font-weight: bold; transition: 0.3s; }
    #wordContainer { height: 180px; display: flex; justify-content: center; align-items: center; position: relative; margin-top: 10px; }
    #wordCanvas { font-size: 85px; direction: rtl; font-weight: bold; text-shadow: 0 0 15px rgba(255,255,255,0.3); }
    select { padding: 10px; font-size: 16px; border-radius: 8px; background: #2c003e; color: white; border: 1px solid #ff3d00; margin-bottom: 10px; }
    input { padding: 15px; font-size: 18px; width: 300px; border-radius: 10px; border: none; text-align: center; background: #eee; }
    button { padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; margin: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
    #checkBtn { background-color: #ff3d00; color: white; }
    #hintBtn { background-color: #ffeb3b; color: #333; display: none; }
    #nextLevelBtn { background-color: #00ff88; color: #00334e; display: none; padding: 20px; font-size: 20px; width: 100%; max-width: 400px; margin: 20px auto; animation: pulse 1.5s infinite; }
    #feedback { margin-top: 15px; font-size: 19px; min-height: 80px; line-height: 1.5; }
    .hint-box { color: #ffeb3b; font-size: 18px; margin-top: 10px; padding: 10px; border: 1px dashed #ffeb3b; border-radius: 10px; }
    #wrongListContainer { margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 15px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
    .wrong-item { display: inline-block; background: rgba(255,61,0,0.2); padding: 5px 12px; margin: 5px; border-radius: 20px; border: 1px solid #ff3d00; direction: rtl; font-size: 18px; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .correct::after { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 130px; height: 130px; border: 10px solid #00ff88; border-radius: 50%; opacity: 0.7; }
</style>
</head>
<body>

<div id="statusBoard">
    <div>STAGE: <span id="lvDisplay">1</span></div>
    <div>POINTS: <span id="scoreDisplay" style="color:#00ff88">10</span> P</div>
    <div>REMAIN: <span id="remainDisplay">0</span></div>
</div>

<div id="eventIndicator"></div>

<select id="chapterSelect" onchange="changeChapter()"></select>

<div id="wordContainer">
    <span id="wordCanvas">START!</span>
</div>

<div>
    <input type="text" id="answerInput" placeholder="ì–´ê·¼ ëœ» (ì˜ˆ: ë°”ë¼ ì°½ì¡°í•˜ë‹¤)" autocomplete="off">
    <button id="checkBtn" onclick="checkAnswer()">í™•ì¸</button>
    <button id="hintBtn" onclick="buyHint()">ğŸ’¡ íŒíŠ¸ êµ¬ë§¤ (-5P)</button>
</div>

<div id="feedback"></div>
<button id="nextLevelBtn" onclick="levelUp()">ğŸ”¥ NEXT STAGE ğŸ”¥</button>

<div id="wrongListContainer">
    <h3 style="margin: 0;">ğŸ’€ ì˜¤ë‹µ ë³´ê´€ì†Œ (í´ë¦¬ì–´ í•„ìˆ˜)</h3>
    <div id="wrongItems" style="margin-top: 10px;"></div>
</div>

<script>
const bibleData = {
    1: [
        {form:"×‘Ö¼Ö¸×¨Ö¸×", root:"ë°”ë¼", meaning:["ì°½ì¡°í•˜ë‹¤"], gloss:"ê·¸ê°€ ì°½ì¡°í–ˆë‹¤"},
        {form:"×•Ö·×™Ö¼Ö¹××Ö¶×¨", root:"ì•„ë§ˆë¥´", meaning:["ë§í•˜ë‹¤","ì´ë¥´ë‹¤"], gloss:"ê·¸ê°€ ë§í–ˆë‹¤"},
        {form:"×™Ö°×”Ö´×™", root:"í•˜ì•¼", meaning:["ìˆë‹¤","ë˜ë‹¤"], gloss:"ìˆê²Œ ë˜ë¼"},
        {form:"×•Ö·×™Ö¼Ö·×¨Ö°×", root:"ë¼ì•„", meaning:["ë³´ë‹¤"], gloss:"ê·¸ê°€ ë³´ì•˜ë‹¤"},
        {form:"×•Ö·×™Ö¼Ö·×‘Ö°×“Ö¼Öµ×œ", root:"ë°”ë‹¬", meaning:["ë‚˜ëˆ„ë‹¤","êµ¬ë³„í•˜ë‹¤"], gloss:"ê·¸ê°€ ë‚˜ëˆ„ì…¨ë‹¤"}
    ],
    2: [
        {form:"×•Ö·×™Ö°×›Ö»×œÖ¼×•Ö¼", root:"ì¹¼ë¼", meaning:["ë§ˆì¹˜ë‹¤","ì™„ì„±í•˜ë‹¤"], gloss:"ê·¸ë“¤ì´ ë§ˆì³ì¡Œë‹¤"},
        {form:"×•Ö·×™Ö¼Ö´×©×Ö°×‘Ö¼Ö¹×ª", root:"ìƒ¤ë°”íŠ¸", meaning:["ì•ˆì‹í•˜ë‹¤","ì‰¬ë‹¤"], gloss:"ê·¸ê°€ ì‰¬ì…¨ë‹¤"},
        {form:"×•Ö·×™Ö¼Ö´×™×¦Ö¶×¨", root:"ì•¼ì°¨ë¥´", meaning:["ì§€ìœ¼ì‹œë‹¤","ë¹šë‹¤"], gloss:"ê·¸ê°€ ë¹šìœ¼ì…¨ë‹¤"}
    ]
};

let currentChapter = 1, currentVerbs = [], wrongAnswers = [], current = null;
let score = 10, failCount = 0, timer = null, eventMultiplier = 1;

const canvas = document.getElementById("wordCanvas"), input = document.getElementById("answerInput"), 
      feedback = document.getElementById("feedback"), scoreDisp = document.getElementById("scoreDisplay"),
      remainDisp = document.getElementById("remainDisplay"), lvDisp = document.getElementById("lvDisplay"),
      hintBtn = document.getElementById("hintBtn"), nextBtn = document.getElementById("nextLevelBtn"),
      wrongItemsDiv = document.getElementById("wrongItems"), chSelect = document.getElementById("chapterSelect"),
      eventInd = document.getElementById("eventIndicator");

function init() {
    chSelect.innerHTML = Object.keys(bibleData).map(ch => `<option value="${ch}">GENESIS ${ch}</option>`).join("");
    loadChapter(1);
}

function loadChapter(ch) {
    currentChapter = parseInt(ch);
    currentVerbs = [...bibleData[ch]];
    wrongAnswers = [];
    failCount = 0;
    lvDisp.innerText = ch;
    nextBtn.style.display = "none";
    updateStatus();
    newQuestion();
}

function changeChapter() { loadChapter(chSelect.value); }

function updateStatus() {
    scoreDisp.innerText = score;
    remainDisp.innerText = currentVerbs.length;
    wrongItemsDiv.innerHTML = wrongAnswers.length === 0 ? "ë³´ê´€ì†Œê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤." : 
        wrongAnswers.map(v => `<span class="wrong-item">${v.form}</span>`).join("");
}

function newQuestion() {
    if(currentVerbs.length === 0 && wrongAnswers.length === 0) {
        canvas.innerText = "MASTERED";
        feedback.innerHTML = `<b style="color:#00ff88">STREET CLEAR! ${currentChapter}ì¥ì„ ì •ë³µí–ˆìŠµë‹ˆë‹¤!</b>`;
        nextBtn.style.display = "block";
        return;
    }
    canvas.className = "";
    hintBtn.style.display = "none";
    failCount = 0;
    
    // ëœë¤ ì´ë²¤íŠ¸ ë°œìƒ (20% í™•ë¥ ë¡œ 2ë°° ì°¬ìŠ¤, 10% í™•ë¥ ë¡œ 2ë°° ìœ„ê¸°)
    const rand = Math.random();
    if(rand < 0.2) {
        eventMultiplier = 2;
        eventInd.innerText = "â­ ë”ë¸” í¬ì¸íŠ¸ ì°¬ìŠ¤! (+20P)";
        eventInd.style.color = "#00ff88";
    } else if(rand < 0.3) {
        eventMultiplier = 2;
        eventInd.innerText = "âš ï¸ ë°ì¸ì € ëª¨ë“œ! ê°ì  2ë°° (-4P)";
        eventInd.style.color = "#ff3d00";
    } else {
        eventMultiplier = 1;
        eventInd.innerText = "";
    }

    let source = wrongAnswers.length > 0 ? wrongAnswers : currentVerbs;
    current = source[Math.floor(Math.random() * source.length)];
    canvas.innerText = current.form;
    feedback.innerHTML = ""; input.value = ""; input.focus();
}

function updateScore(amount) {
    score += amount;
    if (score < 0) {
        gameOver();
    } else {
        scoreDisp.innerText = score;
    }
}

function gameOver() {
    alert("ğŸ’€ GAME OVER! ì ìˆ˜ê°€ 0ë¯¸ë§Œì´ ë˜ì—ˆìŠµë‹ˆë‹¤.\nëª¨ë“  ê¸°ë¡ì´ ì†Œë©¸ë˜ë©° STAGE 1ë¡œ ì¶”ë°©ë©ë‹ˆë‹¤.");
    score = 10;
    currentChapter = 1;
    chSelect.value = 1;
    loadChapter(1);
}

function checkAnswer() {
    if(timer) clearTimeout(timer);
    const p = input.value.trim().split(/\s+/);
    const isCorrect = (normalize(p[0]||"") == normalize(current.root)) && 
                      current.meaning.some(m => normalize(m) == normalize(p.slice(1).join("")));

    if(isCorrect) {
        canvas.className = "correct";
        const earn = 10 * (eventInd.innerText.includes("ì°¬ìŠ¤") ? 2 : 1);
        updateScore(earn);
        feedback.innerHTML = `<b style="color:#00ff88">+${earn}P SUCCESS!</b><br>ì–´ê·¼: ${current.root}`;
        
        currentVerbs = currentVerbs.filter(v => v.form !== current.form);
        wrongAnswers = wrongAnswers.filter(v => v.form !== current.form);
        updateStatus();
        timer = setTimeout(newQuestion, 2000);
    } else {
        failCount++;
        const loss = -2 * (eventInd.innerText.includes("ìœ„ê¸°") ? 2 : 1);
        updateScore(loss);
        if(score < 0) return;

        input.value = ""; input.focus();
        feedback.innerHTML = `<b style="color:#ff3d00">FAILED! (${failCount}íšŒ)</b> ${loss}P ê°ì !`;
        if(failCount >= 3) hintBtn.style.display = "inline-block";
        if(failCount >= 5) {
            feedback.innerHTML = `<b style="color:#ffeb3b">TIMEOUT! ì •ë‹µ: [${current.root} ${current.meaning[0]}]</b>`;
            timer = setTimeout(newQuestion, 4000);
        }
        addWrong(current);
        updateStatus();
    }
}

function addWrong(v) { if(!wrongAnswers.find(w => w.form === v.form)) wrongAnswers.push(v); }

function buyHint() {
    if(score < 5) { feedback.innerHTML = "ì ìˆ˜ ë¶€ì¡±! (5P í•„ìš”)"; return; }
    updateScore(-5);
    const r = current.root.split("");
    const rIdx = Math.floor(Math.random() * r.length);
    const hintRoot = r.map((c, i) => i === rIdx ? c : "ã…‡").join("");
    const hintMean = current.meaning[0].charAt(0) + "ã…‡ã…‡";
    
    feedback.innerHTML = `<div class="hint-box">ğŸ’¸ íŒíŠ¸ êµ¬ë§¤ ì™„ë£Œ (-5P)<br>ì–´ê·¼: [${hintRoot}] / ëœ»: [${hintMean}]</div>`;
    hintBtn.style.display = "none";
}

function levelUp() {
    const next = currentChapter + 1;
    if(bibleData[next]) { chSelect.value = next; loadChapter(next); }
    else { alert("ë°ì´í„°ê°€ ë” ì—†ìŠµë‹ˆë‹¤!"); }
}

function normalize(t){return t.trim().replace(/\s+/g,"");}
input.addEventListener("keypress", e => { if(e.key==="Enter") checkAnswer(); });
init();
</script>

</body>
</html>
