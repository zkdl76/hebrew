<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Genesis Root Master v2.0</title>
<style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f2027, #2c5364); color: white; text-align: center; min-height: 100vh; padding: 20px; }
    #wordContainer { height: 220px; display: flex; justify-content: center; align-items: center; position: relative; margin-top: 10px; }
    #wordCanvas { font-size: 90px; direction: rtl; font-weight: bold; transition: 0.3s; }
    select { padding: 10px; font-size: 16px; border-radius: 8px; margin-bottom: 20px; background: #1a2a6c; color: white; border: 1px solid #00d4ff; }
    input { padding: 15px; font-size: 18px; width: 320px; border-radius: 10px; border: none; text-align: center; }
    button { padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; margin: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
    #checkBtn { background-color: #00d4ff; color: #00334e; }
    #reviewBtn { background-color: #ff3d00; color: white; display: none; }
    #feedback { margin-top: 15px; font-size: 19px; min-height: 120px; line-height: 1.5; }
    .hint-box { color: #ffeb3b; font-size: 18px; margin-top: 5px; font-weight: bold; }
    #wrongListContainer { margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
    .wrong-item { display: inline-block; background: rgba(255,61,0,0.2); padding: 5px 12px; margin: 5px; border-radius: 20px; border: 1px solid #ff3d00; direction: rtl; font-size: 20px; }
    .correct::after { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 140px; height: 140px; border: 10px solid #00ff88; border-radius: 50%; pointer-events: none; opacity: 0.7; }
    .wrong::after { content: "âœ•"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff3d00; font-size: 160px; font-weight: 900; pointer-events: none; opacity: 0.7; }
</style>
</head>
<body>

<h2>Genesis Root Master</h2>

<!-- 1. ì¥ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
<select id="chapterSelect" onchange="changeChapter()">
    <!-- JSì—ì„œ ìë™ ìƒì„±ë¨ -->
</select>

<div id="modeIndicator" style="color: #ffeb3b; font-weight: bold;">[ ì „ì²´ í•™ìŠµ ëª¨ë“œ ]</div>

<div id="wordContainer">
    <span id="wordCanvas"></span>
</div>

<div>
    <input type="text" id="answerInput" placeholder="ì–´ê·¼ëª… ëœ» (ì˜ˆ: ë°”ë¼ ì°½ì¡°í•˜ë‹¤)" autocomplete="off">
    <button id="checkBtn" onclick="checkAnswer()">í™•ì¸</button>
</div>

<div id="feedback"></div>

<div id="wrongListContainer">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">âŒ ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸</h3>
        <button id="reviewBtn" onclick="startReviewMode()">ì˜¤ë‹µë§Œ ì—°ìŠµí•˜ê¸°</button>
    </div>
    <div id="wrongItems" style="margin-top: 10px;">í‹€ë¦° ë‹¨ì–´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
</div>

<script>
// ë°ì´í„° êµ¬ì¡°: ì¥ë³„ë¡œ ì–´ê·¼ ê´€ë¦¬
const bibleData = {
    1: [
        {form:"×‘×¨×", root:"ë°”ë¼", meaning:["ì°½ì¡°í•˜ë‹¤"], gloss:"ê·¸ê°€ ì°½ì¡°í–ˆë‹¤"},
        {form:"×•×™×××¨", root:"ì•„ë§ˆë¥´", meaning:["ë§í•˜ë‹¤","ì´ë¥´ë‹¤"], gloss:"ê·¸ê°€ ë§í–ˆë‹¤"},
        {form:"×™×”×™", root:"í•˜ì•¼", meaning:["ìˆë‹¤","ë˜ë‹¤"], gloss:"ìˆê²Œ ë˜ë¼"},
        {form:"×•×™×¨×", root:"ë¼ì•„", meaning:["ë³´ë‹¤"], gloss:"ê·¸ê°€ ë³´ì•˜ë‹¤"},
        {form:"×•×™×‘×“×œ", root:"ë°”ë‹¬", meaning:["ë‚˜ëˆ„ë‹¤","êµ¬ë³„í•˜ë‹¤"], gloss:"ê·¸ê°€ ë‚˜ëˆ„ì…¨ë‹¤"}
    ],
    2: [
        {form:"×•×™×›×œ×•", root:"ì¹¼ë¼", meaning:["ë§ˆì¹˜ë‹¤","ì™„ì„±í•˜ë‹¤"], gloss:"ê·¸ë“¤ì´ ë§ˆì³ì¡Œë‹¤"},
        {form:"×•×™×©×‘×ª", root:"ìƒ¤ë°”íŠ¸", meaning:["ì•ˆì‹í•˜ë‹¤","ì‰¬ë‹¤"], gloss:"ê·¸ê°€ ì‰¬ì…¨ë‹¤"},
        {form:"×•×™×™×¦×¨", root:"ì•¼ì°¨ë¥´", meaning:["ì§€ìœ¼ì‹œë‹¤","ë¹šë‹¤"], gloss:"ê·¸ê°€ ë¹šìœ¼ì…¨ë‹¤"}
    ]
};

let currentChapter = 1;
let currentVerbs = [];
let wrongAnswers = [];
let current = null;
let timer = null;
let isReviewMode = false;
let failCount = 0; // 3íšŒ ì˜¤ë‹µ ì²´í¬ìš©

const canvas = document.getElementById("wordCanvas"), 
      input = document.getElementById("answerInput"), 
      feedback = document.getElementById("feedback"),
      wrongItemsDiv = document.getElementById("wrongItems"), 
      reviewBtn = document.getElementById("reviewBtn"), 
      modeInd = document.getElementById("modeIndicator"),
      chSelect = document.getElementById("chapterSelect");

// ì´ˆê¸° ì„¤ì •
function init() {
    // ë“œë¡­ë‹¤ìš´ ìƒì„±
    chSelect.innerHTML = Object.keys(bibleData).map(ch => `<option value="${ch}">ì°½ì„¸ê¸° ${ch}ì¥</option>`).join("");
    loadChapter(1);
}

function loadChapter(ch) {
    currentChapter = ch;
    currentVerbs = [...bibleData[ch]];
    wrongAnswers = [];
    isReviewMode = false;
    updateWrongDisplay();
    modeInd.innerText = `[ ${ch}ì¥ ì „ì²´ í•™ìŠµ ëª¨ë“œ ]`;
    modeInd.style.color = "#ffeb3b";
    newQuestion();
}

function changeChapter() {
    loadChapter(chSelect.value);
}

function normalize(t){return t.trim().replace(/\s+/g,"");}

function newQuestion(){
    if(currentVerbs.length === 0) {
        if(wrongAnswers.length === 0) {
            feedback.innerHTML = `<b style="color:#00ff88; font-size:24px;">âœ¨ ${currentChapter}ì¥ ì •ë³µ ì™„ë£Œ! âœ¨</b><br>ë“œë¡­ë‹¤ìš´ì—ì„œ ë‹¤ìŒ ì¥ì„ ì„ íƒí•˜ì„¸ìš”.`;
        } else {
            feedback.innerHTML = "í•´ë‹¹ ì¥ì˜ ëª¨ë“  ë‹¨ì–´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.<br>ì˜¤ë‹µ ë…¸íŠ¸ë¥¼ í•´ê²°í•´ ë³´ì„¸ìš”!";
        }
        canvas.innerText = "ë";
        return;
    }
    canvas.className = "";
    failCount = 0;
    current = currentVerbs[Math.floor(Math.random()*currentVerbs.length)];
    canvas.innerText = current.form;
    feedback.innerHTML = "";
    input.value = "";
    input.focus();
}

function checkAnswer(){
    if(timer) clearTimeout(timer);
    const p = input.value.trim().split(/\s+/);
    const rootOk = normalize(p[0]||"") == normalize(current.root);
    const meaningOk = current.meaning.some(m => normalize(m) == normalize(p.slice(1).join("")));
    const isCorrect = rootOk && meaningOk;

    if(isCorrect) {
        canvas.className = "correct";
        feedback.innerHTML = `<b style="color:#00ff88">ì •ë‹µ!</b><br>ì–´ê·¼: ${current.root}<br>ì˜ë¯¸: ${current.meaning.join(", ")}`;
        
        currentVerbs = currentVerbs.filter(v => v.form !== current.form);
        if(isReviewMode) {
            wrongAnswers = wrongAnswers.filter(v => v.form !== current.form);
            updateWrongDisplay();
        }
        timer = setTimeout(newQuestion, 2000);
    } else {
        canvas.className = "wrong";
        failCount++;
        addWrongList(current);
        
        if(failCount >= 4) {
            // 4ë²ˆì§¸ í‹€ë¦¬ë©´ ì •ë‹µ ê³µê°œ í›„ ê°•ì œ ì´ë™
            feedback.innerHTML = `<b style="color:#ffeb3b">ê¸°íšŒ ì¢…ë£Œ!</b><br>ì •ë‹µì€ <b style="color:#00d4ff">${current.root} ${current.meaning[0]}</b> ì…ë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.`;
            timer = setTimeout(newQuestion, 4000); 
        } else if(failCount === 3) {
            // 3ë²ˆì§¸ í‹€ë¦¬ë©´ íŒíŠ¸ ì œê³µ
            let hintRoot = current.root.charAt(0);
            let hintMean = current.meaning[0].charAt(0);
            feedback.innerHTML = `<b style="color:#ff3d00">ì˜¤ë‹µ! (3íšŒ)</b><br><div class="hint-box">ğŸ’¡ íŒíŠ¸: '${hintRoot}...' '${hintMean}...'</div>`;
        } else {
            feedback.innerHTML = `<b style="color:#ff3d00">ì˜¤ë‹µ! (${failCount}íšŒ)</b><br>ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!`;
        }
    }
}


function addWrongList(item) {
    if(!wrongAnswers.find(v => v.form === item.form)) {
        wrongAnswers.push(item);
        updateWrongDisplay();
    }
}

function updateWrongDisplay() {
    if(wrongAnswers.length === 0) {
        wrongItemsDiv.innerText = "ë‚¨ì€ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤!";
        reviewBtn.style.display = "none";
    } else {
        wrongItemsDiv.innerHTML = wrongAnswers.map(v => `<span class="wrong-item">${v.form}</span>`).join("");
        reviewBtn.style.display = "inline-block";
    }
}

function startReviewMode() {
    if(wrongAnswers.length === 0) return;
    isReviewMode = true;
    currentVerbs = [...wrongAnswers];
    modeInd.innerText = `[ ${currentChapter}ì¥ ì˜¤ë‹µ ë³µìŠµ ëª¨ë“œ ]`;
    modeInd.style.color = "#ff3d00";
    newQuestion();
}

input.addEventListener("keypress", e => { if(e.key==="Enter") checkAnswer(); });
init();
</script>
</body>
</html>
